package com.dev.cloud.controller;

import java.io.FileInputStream;
import java.io.IOException;
import java.util.List;

import javax.servlet.ServletOutputStream;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.util.FileCopyUtils;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;

import com.dev.cloud.dao.PatentRepository;
import com.dev.cloud.dao.PatentSubRepository;
import com.dev.cloud.vo.Patent;
import com.dev.cloud.vo.Patentsub;
import com.dev.cloud.vo.PdpVo;

@Controller
@RequestMapping("/patent")
public class PatentController {
	
	final String uploadPath = "/Saved";
	
	@Autowired
	PatentRepository papo;
	@Autowired
	PatentSubRepository supo;
	
	
	//Patent 분류, 특허명, 특허번호 / devMember patentHoldName, memberId,  / PTI 신청날짜
	@RequestMapping(value = "/patentUseList", method = RequestMethod.GET)
	public String patentUseList(HttpSession session, Model model) { //split을 사용해서 파일을 두가지로 나눈다 => downLoad => file upload(ajax 처리)
		String name = (String) session.getAttribute("loginName");
		List<PdpVo> pList =  papo.pdpIdAll(name);  //Patent 나머지 와  devMember 신청자 이름, PTI의 신청날짜 합친 VO 필요 
		
		for(int i =0;i<pList.size();i++){
			
		}
		System.out.println("28번줄pList==>"+pList);
		
		for(int i =0; i<pList.size();i++){
			//pList.set(i, )
		}
		
		System.out.println("29번줄==>"+pList.size());
		model.addAttribute("pList",pList);
		return "/patent/patent_use_list";
	}
	
	@RequestMapping(value="/download" , method= RequestMethod.GET)
	public String download(HttpSession session,int patentNum, HttpServletResponse response){
		String memberId = (String) session.getAttribute("loginId");
		
		
		//response.setHeader("Content-Disposition","attachment;filename="+originalfile)
		/*Board board = repo.selectOne(boardseq);
		String sp =  ptd.get 특허 파일 ;
		
		String [] array = sp.split("@");
		String savedfile = "";
		String originalfile = ""; 
		for(int i = 0;i<array.length;i++){
			originalfile = array[0];
			savedfile = array[1];
		}
		
		
		String fullPath = uploadPath+"/"+ savedfile;
		
		FileInputStream fis =null;
		ServletOutputStream sos = null;
		
		try {
			fis = new FileInputStream(fullPath);
			sos = response.getOutputStream();
			
			FileCopyUtils.copy(fis, sos);
			
			fis.close();
			sos.close();
		} catch (IOException e) {
			e.printStackTrace();
		}
		
		
		//savedfile = board.getSavedfile();
		//originalfile = board.getOriginalfile();
		
		
		
		*/
		return null;
	}
	
	
}
